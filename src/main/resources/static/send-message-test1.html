<body>
<h2>채팅방</h2>
<div id="messages" style="border:1px solid #ccc; padding:10px; height:200px; overflow-y:auto;"></div>

<input type="text" id="messageInput" placeholder="메시지 입력" />
<button onclick="sendMessage()">전송</button>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
  const roomId = 1;
  const senderId = 1; // 다른 HTML에선 2로 설정해보세요!

  const socket = new SockJS("http://localhost:8080/ws");
  const stompClient = Stomp.over(socket);

  stompClient.connect({}, function (frame) {
    console.log("✅ 연결 성공", frame);

    stompClient.subscribe(`/queue/chatrooms/${roomId}`, function (message) {
      const msg = JSON.parse(message.body);
      console.log("📨 받은 메시지:", msg);

      const messageBox = document.getElementById("messages");
      const div = document.createElement("div");
      div.innerText = `👤 ${msg.senderId}: ${msg.chatContent}`;
      messageBox.appendChild(div);
    });
  });

  function sendMessage() {
    const content = document.getElementById("messageInput").value;
    const payload = {
      chatroomId: roomId,
      senderId: senderId,
      content: content
    };

    stompClient.send(`/app/${roomId}/message`, {}, JSON.stringify(payload));
    document.getElementById("messageInput").value = "";
  }
</script>
</body>
