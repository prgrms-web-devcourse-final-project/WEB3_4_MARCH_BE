<body>
<h2>ì±„íŒ…ë°©</h2>
<div id="messages" style="border:1px solid #ccc; padding:10px; height:200px; overflow-y:auto;"></div>

<input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" />
<button onclick="sendMessage()">ì „ì†¡</button>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
  const roomId = 1;
  const senderId = 1; // ë‹¤ë¥¸ HTMLì—ì„  2ë¡œ ì„¤ì •í•´ë³´ì„¸ìš”!

  const socket = new SockJS("http://localhost:8080/ws");
  const stompClient = Stomp.over(socket);

  stompClient.connect({}, function (frame) {
    console.log("âœ… ì—°ê²° ì„±ê³µ", frame);

    stompClient.subscribe(`/queue/chatrooms/${roomId}`, function (message) {
      const msg = JSON.parse(message.body);
      console.log("ğŸ“¨ ë°›ì€ ë©”ì‹œì§€:", msg);

      const messageBox = document.getElementById("messages");
      const div = document.createElement("div");
      div.innerText = `ğŸ‘¤ ${msg.senderId}: ${msg.chatContent}`;
      messageBox.appendChild(div);
    });
  });

  function sendMessage() {
    const content = document.getElementById("messageInput").value;
    const payload = {
      chatroomId: roomId,
      senderId: senderId,
      content: content
    };

    stompClient.send(`/app/${roomId}/message`, {}, JSON.stringify(payload));
    document.getElementById("messageInput").value = "";
  }
</script>
</body>
